# Система прогнозирования поломок оборудования IoT Monitor

Интеллектуальная система для мониторинга, анализа и прогнозирования отказов промышленного оборудования на основе данных датчиков. Система собирает показания датчиков (температура, вибрация, давление, ток), анализирует их с помощью алгоритмов машинного обучения и предупреждает о потенциальных проблемах до их возникновения.

## Описание проекта

Система разработана для повышения надёжности промышленных систем путём:

- Мониторинга состояния оборудования в реальном времени
- Автоматического обнаружения аномалий в показаниях датчиков
- Прогнозирования вероятности отказов с использованием ML моделей
- Отправки уведомлений о критических событиях по email
- Генерации отчётов для анализа и планирования обслуживания

## Архитектура и диаграмма классов

Проект разработан на основе предоставленных диаграмм, которая описывает структуру системы с пользователями, основными сущностями и подсистемами, а также интерфеса. Реализация максимально следует диаграмме (я стремился к этому), с учётом особенностей Python и выбранных технологий.

### Основные изменения относительно диаграммы:

1. **Наследование пользователей**: В Python/SQLAlchemy невозможно создать абстрактный класс напрямую, поэтому использован паттерн Single Table Inheritance с полем `user_type` как дискриминатором. Классы `Operator`, `Administrator` и `Manager` наследуются от `User`.

2. **Интерфейсы**: Python не поддерживает интерфейсы в классическом понимании, поэтому интерфейсы `DataCollector`, `Analyzer`, `Notifier` и `UIService` реализованы через абстрактные базовые классы (ABC) с декораторами `@abstractmethod`.

3. **MQTT/HTTP клиенты**: Вместо реальных IoT устройств используется генерация синтетических данных. Атрибуты `mqttClient` и `httpClient` в `DataCollectionSubsystem` заменены на параметры генерации данных.

4. **База данных**: Вместо PostgreSQL (указанной в диаграмме) используется SQLite для локального развёртывания.

5. **Уведомления**: Используется только email для всех уведомлений.

6. **Мобильное приложение**: Атрибут `mobileApp` в `UISubsystem` не реализован, так как требуется только веб-приложение.

## Основные модули системы

### Backend (Python/FastAPI)

#### Модели данных (`backend/models/`)

- **user.py**: Иерархия пользователей (User → Operator, Administrator, Manager) с ролевым доступом
- **equipment.py**: Оборудование, датчики, данные датчиков и оповещения
- **maintenance.py**: Записи об обслуживании оборудования

#### Подсистемы (`backend/services/`)

- **data_collection.py**: `DataCollectionSubsystem` - сбор и генерация синтетических данных датчиков каждые 8 секунд, фильтрация шумов, проверка пороговых значений
- **analysis.py**: `AnalysisSubsystem` - анализ данных, обнаружение аномалий, прогнозирование отказов с использованием ML моделей
- **notifications.py**: `NotificationSubsystem` - отправка email уведомлений о критических событиях
- **seed.py**: Инициализация базы данных демонстрационными данными

#### Машинное обучение (`backend/ml/`)

- **random_forest.py**: Модель Random Forest для классификации состояния оборудования (нормальное/требует внимания/критическое)
- **lstm.py**: Упрощённая LSTM модель для прогнозирования временных рядов (использует авторегрессию)
- **models.py**: Менеджер для сохранения и загрузки обученных моделей

#### API роутеры (`backend/routers/`)

- **auth.py**: Аутентификация через JWT, управление пользователями
- **dashboard.py**: Статистика для главной страницы, данные для графиков
- **equipment.py**: CRUD операции с оборудованием, история обслуживания
- **sensors.py**: Получение данных датчиков, ручной ввод данных
- **events.py**: Список оповещений и событий системы
- **reports.py**: Генерация PDF и CSV отчётов
- **predictions.py**: Прогнозирование отказов оборудования, обнаружение аномалий

#### Утилиты (`backend/utils/`)

- **auth.py**: Хеширование паролей (bcrypt), создание/декодирование JWT токенов
- **dependencies.py**: FastAPI зависимости для проверки ролей и авторизации
- **email.py**: Обёртка над smtplib для отправки email
- **reports.py**: Генерация PDF (ReportLab) и CSV отчётов

### Frontend (React)

#### Компоненты (`frontend/src/components/`)

- **Dashboard**: Главная страница со статистикой и графиками температуры
- **Devices**: Список оборудования с возможностью просмотра деталей, запуска прогнозов, добавления записей об обслуживании
- **Events**: Лента событий и оповещений с фильтрацией и статистикой
- **Reports**: Генерация и скачивание отчётов в PDF/CSV форматах
- **Login**: Страница входа в систему
- **Layout**: Общий макет приложения с навигацией

#### API клиент (`frontend/src/api/`)

- Централизованный клиент на основе axios с автоматической добавкой JWT токенов
- Интерцепторы для обработки ошибок и перенаправления на страницу входа

#### Контекст (`frontend/src/context/`)

- **AuthContext**: Управление состоянием аутентификации, проверка ролей пользователей

## Как работает программа

### Поток данных

1. **Сбор данных**: `DataCollectionSubsystem` каждые 8 секунд генерирует синтетические данные для всех датчиков, имитируя работу реальных IoT устройств. Данные фильтруются от шумов и сохраняются в базу данных.

2. **Анализ**: При сохранении данных проверяются пороговые значения. При превышении порогов создаются оповещения (`Alert`). Для критических событий автоматически отправляются email уведомления всем пользователям.

3. **Прогнозирование**: По запросу администратора `AnalysisSubsystem` использует ML модели (Random Forest и LSTM) для оценки вероятности отказа оборудования в ближайшие 24-48 часов. Модели анализируют исторические данные датчиков и текущее состояние оборудования.

4. **Визуализация**: Frontend запрашивает данные через REST API, отображает их в виде графиков, таблиц и карточек. Пользователи могут взаимодействовать с системой: просматривать детали оборудования, запускать прогнозы, добавлять записи об обслуживании.

### Роли пользователей

- **Оператор**: Просмотр оборудования и событий, добавление записей об обслуживании, изменение статуса оборудования
- **Администратор**: Все функции оператора + управление пользователями, создание оборудования, запуск прогнозов, генерация отчётов
- **Менеджер**: Все функции администратора + просмотр аналитики, скачивание отчётов

## Запуск системы

### Требования

- Python 3.11+
- Node.js 16+
- uv (менеджер пакетов Python) или pip

### Backend

1. Установите зависимости:

```bash
cd backend
uv sync
# или
pip install -r requirements.txt
```

2. (Опционально) Настройте email в файле `backend/.env`:

```
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASSWORD=your_app_password
EMAIL_FROM=your_email@gmail.com
```

3. Запустите сервер:

```bash
uv run main.py
# или
python main.py
```

Сервер запустится на `http://localhost:8000`. API документация доступна по адресу `http://localhost:8000/docs`.

### Frontend

1. Установите зависимости:

```bash
cd frontend
npm install
```

2. Запустите приложение:

```bash
npm start
```

Приложение откроется в браузере на `http://localhost:3000`.

### Тестовые учётные записи

После первого запуска создаются демонстрационные пользователи:

- **Оператор**: `operator@test.com` / `operator123`
- **Администратор**: `admin@test.com` / `admin123`
- **Менеджер**: `manager@test.com` / `manager123`
- **Тестовый пользователь**: `telezboez@gmail.com` / `test123` (был создан мною для проверки работы сервиса отправки email сообщений)

## Демонстрация работы системы

### Скриншоты


1. Главная страница (Dashboard) с графиками и статистикой
   <img width="1920" height="1082" alt="Screenshot 2025-12-09 at 18 59 18" src="https://github.com/user-attachments/assets/ae8645e0-4d8c-4095-b809-41818c0fbafe" />

   
2. Страница устройств с модальным окном деталей
     <img width="1920" height="1082" alt="Screenshot 2025-12-09 at 18 58 54" src="https://github.com/user-attachments/assets/805ecb4e-e588-422f-825f-3a70c98e6d1c" />

     
3. Страница событий с оповещениями
   <img width="1920" height="1082" alt="Screenshot 2025-12-09 at 18 59 03" src="https://github.com/user-attachments/assets/edc823c9-837f-42f0-9f36-19c0e152e1d4" />
   

4. Страница отчётов
<img width="1920" height="1082" alt="Screenshot 2025-12-09 at 18 59 13" src="https://github.com/user-attachments/assets/da314926-bbeb-4ecf-977f-0df71330931a" />


### Видео демонстрация

https://github.com/user-attachments/assets/fb691da0-1e83-49c7-9323-628fc4e8981d

## Комментарии заказчика

<!-- Вставьте отзыв заказчика о работе системы здесь -->

---

## Технологии

**Backend:**

- FastAPI - веб-фреймворк
- SQLAlchemy - ORM для работы с базой данных
- SQLite - база данных
- PyJWT - JWT токены для аутентификации
- bcrypt - хеширование паролей
- scikit-learn - Random Forest модель
- TensorFlow/Keras - LSTM модель (опционально)
- ReportLab - генерация PDF отчётов
- smtplib - отправка email
- python-dotenv - загрузка переменных окружения

**Frontend:**

- React 19 - UI библиотека
- React Router - маршрутизация
- Axios - HTTP клиент
- CSS3 - стилизация

## Лицензия

Проект разработан в учебных целях, но получилось так круто, что больше похож на продакшен реди проект:)
